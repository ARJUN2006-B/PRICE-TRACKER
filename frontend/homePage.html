<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Price Tracker</title>
  <link rel="stylesheet" href="home.css" />
</head>


<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">T r a c k I T</div>
    <ul class="nav-links">
    <li><a href="/frontend/About.html">About</a></li>
    <li><a href="/frontend/alerts.html">Alerts</a></li>

   <li id="logoutBtn" style="background-color: #6a0dad; color: white;cursor: pointer;">Logout</li>
    </ul>
  </nav>


  <!-- Header Section -->
  <header>
    <div class="logo-container">
    <img src="images/logo.png" alt="TrackIT Logo" class="main-logo">
</div>
    <p class="tagline">Find the best deals across your favorite stores in one click!</p>
  </header>

  <!-- Ecommerce Logos -->
  

  <!-- Search Bar -->
  <section class="search-section">
 <input type="text" id="productUrl" placeholder="Enter product URL" />
    <button onclick="validateUrl()" style="color: white;">Search</button>
   
  </section>
  <div class="barcode-reader">
  <button type="button" class="barcode-btn" onclick="window.location.href='scanner.html'">
    <img src="images/search-barcode.png" alt="Scan Barcode" />
    <span>Scan Barcode</span>
  </button>
</div>


  <!-- Trending Products Section -->
  <section class="trending-section">
    <h2>ðŸ”¥ Trending Products</h2>
    <div class="product-grid">
      <div class="product-card">
        <img src="images/airpod_img.png" alt="Headphones" />
        <p>Airpods</p>
        <span>â‚¹599</span>
      </div>
      <div class="product-card">
        <img src="images/samrtwatch_img.jpg" alt="Smartwatch" />
        <p>Smartwatch</p>
        <span>â‚¹999</span>
      </div>
      <div class="product-card">
        <img src="images/shoe_img.jpg" alt="Shoes" />
        <p>Sports Shoes</p>
        <span>â‚¹699</span>
      </div>
      <div class="product-card">
        <img src="images/gamingkeyboard_img.jpg" alt="Keyboard" />
        <p>RGB Gaming Keyboard</p>
        <span>â‚¹1,499</span>
      </div>
    </div>
  </section>
  

<!-- Footer -->
<footer>
  <p>Â© 2025 Price Tracker | All Rights Reserved</p>
</footer>

<script>

async function validateUrl() {
  const input = document.getElementById("productUrl");
  if (!input) {
    alert("Product URL input not found");
    return;
  }

  const url = input.value.trim();
  if (!url) {
    alert("Please enter a product URL");
    return;
  }

  if (!url.includes("amazon.")) {
    alert("Only Amazon product URLs are supported right now.");
    return;
  }

  const asin = extractASIN(url);
  if (!asin) {
    alert("Couldn't extract ASIN from this URL.");
    return;
  }

  try {
    // call your backend to scrape + save
    const res = await fetch("http://localhost:3000/api/fetch", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ url }),
    });

    const data = await res.json();
    console.log("Backend response:", data);

    if (!res.ok || data.error) {
      alert("Server error: " + (data.error || "Unknown error"));
      return;
    }

    // redirect to product page with asin
    window.location.href = `product.html?asin=${asin}`;
  } catch (err) {
    console.error(err);
    alert("Failed to reach backend. Is server running on http://localhost:3000 ?");
  }
}

function extractASIN(url) {
  const patterns = [
    /\/dp\/([A-Z0-9]{10})/i,
    /\/gp\/product\/([A-Z0-9]{10})/i,
    /\/product\/([A-Z0-9]{10})/i,
    /\/([A-Z0-9]{10})(?:[/?]|$)/i,
  ];
  for (const p of patterns) {
    const m = url.match(p);
    if (m) return m[1];
  }
  return null;
}

</script>

<script type="module" src="./firebase/config.js"></script>
<script type="module" src="./Login.js"></script>

</body>
</html>
